# ygopro-database

Some databases of ygopro.

They are for now just for test.

## Additional tools

### CDB merge driver

This a setup tool to support CDB files in git merge operations.

For Windows users, run `setup.bat` to install the merge driver. SQLite3 would be automatically installed if not already present in PATH.

For non-Windows users, run `setup.sh` to install the merge driver. You need to have SQLite3 installed by your package manager, `apt`, `brew`, etc.

#### Conflicts

Upon merge conflicts, the merge driver would create a `cards.cdb.sql` file in the current directory. You have to manually resolve the conflicts in this file, delete the original cdb file, and then use the command `sqlite3 cards.cdb < cards.cdb.sql` to apply the changes to the cdb file. After that, you can add the cdb file to the git index and commit the changes.

### Text diverting

Usually the card texts are presented with new lines, while some YGOPro clients or card picture generators need new lines, and some others does not. This script will convert the text to the format you need.

The script is located at `scripts/divert.sh`, which would create `diverted/<locale>-newline/cards.cdb` and `diverted/<locale>-nonewline/cards.cdb` files.

The diverting rule differs for every locale, as follows

### zh-CN diverting rules

For Simplified Chinese (`zh-CN`), the diverting rule is minimal and conservative:

- **Only remove line breaks (`\r`, `\n`, or `\r\n`) that appear between a Chinese full stop (`。`) and a circled number character (①, ②, ..., ⑳).**
  - Example:
    ```
    Original: Sentence ending。<CRLF>① Effect text
    Converted: Sentence ending。① Effect text
    ```
- All other characters, including `\t`, line breaks not matching the above pattern, and spacing are preserved as-is.

This ensures that line-breaking only changes where it might interfere with structured effect numbering.

---

### Non-zh-CN diverting rules

For all other locales (e.g. `en`, `ja`, `ko`), the diverting process aggressively normalizes text while preserving intentional formatting.

#### The following types of line breaks are preserved:

- Lines that consist **only of dashes** (e.g., `------`) will retain both their preceding and trailing line breaks.
- Lines that **start with `[` or `【`** (often used for headers or tags) also retain their surrounding line breaks.
- Any line break that immediately follows a **tab character (`\t`)**, including `\t\r\n`, `\t\n`, or `\t\r`, is preserved. These are treated as "hard line breaks".

#### All other line breaks are removed:

- Line breaks that do not fall under the above cases will be stripped.
- This produces a more compact, paragraph-like text format suitable for display in environments where visual wrapping is handled externally.

---

### newline version rules

The `-newline` version of each locale preserves all line breaks (including `\r`, `\n`, and `\r\n`) and:

- **Removes all tab characters (`\t`)**.

This version is intended for clients that require the original line layout but do not need embedded tab characters.

---

### Example directory structure

```
diverted/
├── zh-CN-newline/
│   └── cards.cdb        # Original line breaks preserved, tabs removed
├── zh-CN-nonewline/
│   └── cards.cdb        # Only breaks between 。 and circled numbers are removed
├── en-US-newline/
│   └── cards.cdb        # Line breaks preserved, tabs removed
├── en-US-nonewline/
│   └── cards.cdb        # Most line breaks removed, structured ones preserved
...
```

These diverted versions are automatically generated by the `scripts/divert.sh` script.
